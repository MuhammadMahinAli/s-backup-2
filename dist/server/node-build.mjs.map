{"version":3,"file":"node-build.mjs","sources":["../../server/routes/demo.ts","../../server/models/Post.ts","../../server/models/Comment.ts","../../server/lib/mongodb.ts","../../server/routes/post.ts","../../server/routes/feed.ts","../../server/routes/comment.ts","../../server/routes/report.ts","../../server/routes/delete.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import { RequestHandler } from \"express\";\nimport { DemoResponse } from \"@shared/api\";\n\nexport const handleDemo: RequestHandler = (req, res) => {\n  const response: DemoResponse = {\n    message: \"Hello from Express server\",\n  };\n  res.status(200).json(response);\n};\n","import mongoose, { Schema, Document } from 'mongoose';\r\n\r\nexport interface IPost extends Document {\r\n  nickname: string;\r\n  text: string;\r\n  imageUrl?: string;\r\n  createdAt: Date;\r\n  topics: string[];\r\n  blurRequested: boolean;\r\n  contentType: 'text' | 'image';\r\n  commentCount: number;\r\n  reportsCount: number;\r\n  status: 'auto' | 'pending';\r\n}\r\n\r\nconst PostSchema = new Schema<IPost>(\r\n  {\r\n    nickname: {\r\n      type: String,\r\n      required: [true, 'Nickname is required'],\r\n      trim: true,\r\n    },\r\n    text: {\r\n      type: String,\r\n      required: [true, 'Text is required'],\r\n      minlength: [20, 'Text must be at least 20 characters'],\r\n      maxlength: [1000, 'Text must not exceed 1000 characters'],\r\n      trim: true,\r\n    },\r\n    imageUrl: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    createdAt: {\r\n      type: Date,\r\n      default: Date.now,\r\n    },\r\n    topics: {\r\n      type: [String],\r\n      default: [],\r\n    },\r\n    blurRequested: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    contentType: {\r\n      type: String,\r\n      enum: ['text', 'image'],\r\n      default: 'text',\r\n    },\r\n    commentCount: {\r\n      type: Number,\r\n      default: 0,\r\n      min: 0,\r\n    },\r\n    reportsCount: {\r\n      type: Number,\r\n      default: 0,\r\n      min: 0,\r\n    },\r\n    status: {\r\n      type: String,\r\n      enum: ['auto', 'pending'],\r\n      default: 'auto',\r\n    },\r\n  },\r\n  {\r\n    timestamps: false, // We're managing createdAt manually\r\n  }\r\n);\r\n\r\n// Create index on createdAt in descending order for efficient querying\r\nPostSchema.index({ createdAt: -1 });\r\n\r\n// Export the model\r\nexport const Post = mongoose.model<IPost>('Post', PostSchema);\r\n\r\n","import mongoose, { Schema, Document, Types } from 'mongoose';\r\n\r\nexport interface IComment extends Document {\r\n  postId: Types.ObjectId;\r\n  nickname: string;\r\n  text: string;\r\n  createdAt: Date;\r\n}\r\n\r\nconst CommentSchema = new Schema<IComment>(\r\n  {\r\n    postId: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: 'Post',\r\n      required: [true, 'Post ID is required'],\r\n    },\r\n    nickname: {\r\n      type: String,\r\n      required: [true, 'Nickname is required'],\r\n      trim: true,\r\n    },\r\n    text: {\r\n      type: String,\r\n      required: [true, 'Text is required'],\r\n      minlength: [5, 'Text must be at least 5 characters'],\r\n      maxlength: [500, 'Text must not exceed 500 characters'],\r\n      trim: true,\r\n    },\r\n    createdAt: {\r\n      type: Date,\r\n      default: Date.now,\r\n    },\r\n  },\r\n  {\r\n    timestamps: false, // We're managing createdAt manually\r\n  }\r\n);\r\n\r\n// Create index on postId in ascending order for efficient querying\r\nCommentSchema.index({ postId: 1 });\r\n\r\n// Export the model\r\nexport const Comment = mongoose.model<IComment>('Comment', CommentSchema);\r\n\r\n","import mongoose from 'mongoose';\r\n\r\nif (!process.env.MONGODB_URI) {\r\n  throw new Error('Please define the MONGODB_URI environment variable');\r\n}\r\n\r\nif (!process.env.MONGODB_DB) {\r\n  throw new Error('Please define the MONGODB_DB environment variable');\r\n}\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI;\r\nconst MONGODB_DB = process.env.MONGODB_DB;\r\n\r\ninterface MongooseCache {\r\n  conn: typeof mongoose | null;\r\n  promise: Promise<typeof mongoose> | null;\r\n}\r\n\r\n// Extend the global type to include our mongoose cache\r\ndeclare global {\r\n  // eslint-disable-next-line no-var\r\n  var mongoose: MongooseCache | undefined;\r\n}\r\n\r\n// Create a cached connection object to prevent multiple connections during hot reload\r\nlet cached: MongooseCache = global.mongoose || { conn: null, promise: null };\r\n\r\nif (!global.mongoose) {\r\n  global.mongoose = cached;\r\n}\r\n\r\n/**\r\n * Connect to MongoDB using Mongoose\r\n * Uses a cached connection to prevent multiple connections during hot reload\r\n */\r\nexport async function connectToDatabase(): Promise<typeof mongoose> {\r\n  // Return existing connection if available\r\n  if (cached.conn) {\r\n    return cached.conn;\r\n  }\r\n\r\n  // Return existing connection promise if one is in progress\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n      dbName: MONGODB_DB,\r\n    };\r\n\r\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongooseInstance) => {\r\n      console.log('âœ… MongoDB connected successfully');\r\n      return mongooseInstance;\r\n    });\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise;\r\n  } catch (e) {\r\n    cached.promise = null;\r\n    throw e;\r\n  }\r\n\r\n  return cached.conn;\r\n}\r\n\r\n/**\r\n * Get the MongoDB database instance\r\n * Ensures connection is established before returning the database\r\n */\r\nexport async function getDatabase() {\r\n  const mongooseInstance = await connectToDatabase();\r\n  return mongooseInstance.connection.db;\r\n}\r\n\r\n/**\r\n * Export the mongoose connection for direct access\r\n */\r\nexport { mongoose };\r\n\r\n/**\r\n * Disconnect from MongoDB (useful for cleanup in tests or graceful shutdown)\r\n */\r\nexport async function disconnectFromDatabase(): Promise<void> {\r\n  if (cached.conn) {\r\n    await cached.conn.disconnect();\r\n    cached.conn = null;\r\n    cached.promise = null;\r\n    console.log('âœ… MongoDB disconnected successfully');\r\n  }\r\n}\r\n\r\n","import { RequestHandler } from 'express';\r\nimport { Post } from '../models';\r\nimport { connectToDatabase } from '../lib/mongodb';\r\n\r\n/**\r\n * POST /api/post\r\n * Create a new post\r\n */\r\nexport const createPost: RequestHandler = async (req, res) => {\r\n  try {\r\n    await connectToDatabase();\r\n\r\n    const { nickname, text, imageUrl, blurRequested, topics } = req.body;\r\n\r\n    // Validate required fields\r\n    if (!nickname || typeof nickname !== 'string') {\r\n      res.status(400).json({ error: 'Nickname is required' });\r\n      return;\r\n    }\r\n\r\n    if (!text || typeof text !== 'string') {\r\n      res.status(400).json({ error: 'Text is required' });\r\n      return;\r\n    }\r\n\r\n    // Validate text length\r\n    const trimmedText = text.trim();\r\n    if (trimmedText.length === 0) {\r\n      res.status(400).json({ error: 'Text cannot be empty' });\r\n      return;\r\n    }\r\n\r\n    if (trimmedText.length < 20) {\r\n      res.status(400).json({ error: 'Text must be at least 20 characters' });\r\n      return;\r\n    }\r\n\r\n    if (trimmedText.length > 1000) {\r\n      res.status(400).json({ error: 'Text must not exceed 1000 characters' });\r\n      return;\r\n    }\r\n\r\n    // Determine content type\r\n    const contentType = imageUrl && imageUrl.trim() ? 'image' : 'text';\r\n\r\n    // Create the post\r\n    const post = await Post.create({\r\n      nickname: nickname.trim(),\r\n      text: trimmedText,\r\n      imageUrl: imageUrl?.trim() || undefined,\r\n      blurRequested: blurRequested === true,\r\n      topics: Array.isArray(topics) ? topics : [],\r\n      contentType,\r\n    });\r\n\r\n    res.status(201).json(post);\r\n  } catch (error) {\r\n    console.error('Error creating post:', error);\r\n    \r\n    // Handle Mongoose validation errors\r\n    if (error instanceof Error && error.name === 'ValidationError') {\r\n      res.status(400).json({ error: error.message });\r\n      return;\r\n    }\r\n    \r\n    res.status(500).json({ error: 'Failed to create post' });\r\n  }\r\n};\r\n\r\n","import { RequestHandler } from 'express';\r\nimport { Post } from '../models';\r\nimport { connectToDatabase } from '../lib/mongodb';\r\n\r\n/**\r\n * GET /api/feed\r\n * Get paginated posts with status='auto'\r\n * Query params: page (default 1), limit (default 10)\r\n */\r\nexport const getFeed: RequestHandler = async (req, res) => {\r\n  try {\r\n    await connectToDatabase();\r\n\r\n    // Parse pagination parameters\r\n    const page = Math.max(1, parseInt(req.query.page as string) || 1);\r\n    const limit = Math.min(50, Math.max(1, parseInt(req.query.limit as string) || 10));\r\n    const skip = (page - 1) * limit;\r\n\r\n    // Get posts with status='auto' sorted by createdAt desc\r\n    const [posts, total] = await Promise.all([\r\n      Post.find({ status: 'auto' })\r\n        .sort({ createdAt: -1 })\r\n        .skip(skip)\r\n        .limit(limit)\r\n        .lean()\r\n        .exec(),\r\n      Post.countDocuments({ status: 'auto' }),\r\n    ]);\r\n\r\n    res.json({\r\n      posts,\r\n      total,\r\n      page,\r\n      limit,\r\n      totalPages: Math.ceil(total / limit),\r\n    });\r\n  } catch (error) {\r\n    console.error('Error fetching feed:', error);\r\n    res.status(500).json({ error: 'Failed to fetch feed' });\r\n  }\r\n};\r\n\r\n","import { RequestHandler } from 'express';\r\nimport { Types } from 'mongoose';\r\nimport { Comment, Post } from '../models';\r\nimport { connectToDatabase } from '../lib/mongodb';\r\n\r\n/**\r\n * POST /api/comment\r\n * Create a new comment and increment post's comment count\r\n */\r\nexport const createComment: RequestHandler = async (req, res) => {\r\n  try {\r\n    await connectToDatabase();\r\n\r\n    const { postId, nickname, text } = req.body;\r\n\r\n    // Validate required fields\r\n    if (!postId || typeof postId !== 'string') {\r\n      res.status(400).json({ error: 'Post ID is required' });\r\n      return;\r\n    }\r\n\r\n    if (!nickname || typeof nickname !== 'string') {\r\n      res.status(400).json({ error: 'Nickname is required' });\r\n      return;\r\n    }\r\n\r\n    if (!text || typeof text !== 'string') {\r\n      res.status(400).json({ error: 'Text is required' });\r\n      return;\r\n    }\r\n\r\n    // Validate text length\r\n    const trimmedText = text.trim();\r\n    if (trimmedText.length < 5) {\r\n      res.status(400).json({ error: 'Text must be at least 5 characters' });\r\n      return;\r\n    }\r\n\r\n    if (trimmedText.length > 500) {\r\n      res.status(400).json({ error: 'Text must not exceed 500 characters' });\r\n      return;\r\n    }\r\n\r\n    // Validate ObjectId\r\n    if (!Types.ObjectId.isValid(postId)) {\r\n      res.status(400).json({ error: 'Invalid post ID' });\r\n      return;\r\n    }\r\n\r\n    // Check if post exists\r\n    const post = await Post.findById(postId);\r\n    if (!post) {\r\n      res.status(404).json({ error: 'Post not found' });\r\n      return;\r\n    }\r\n\r\n    // Create the comment\r\n    const comment = await Comment.create({\r\n      postId: new Types.ObjectId(postId),\r\n      nickname: nickname.trim(),\r\n      text: trimmedText,\r\n    });\r\n\r\n    // Increment post's comment count\r\n    await Post.findByIdAndUpdate(postId, {\r\n      $inc: { commentCount: 1 },\r\n    });\r\n\r\n    res.status(201).json(comment);\r\n  } catch (error) {\r\n    console.error('Error creating comment:', error);\r\n    \r\n    // Handle Mongoose validation errors\r\n    if (error instanceof Error && error.name === 'ValidationError') {\r\n      res.status(400).json({ error: error.message });\r\n      return;\r\n    }\r\n    \r\n    res.status(500).json({ error: 'Failed to create comment' });\r\n  }\r\n};\r\n\r\n/**\r\n * GET /api/comments?postId=<id>\r\n * Get all comments for a specific post\r\n */\r\nexport const getComments: RequestHandler = async (req, res) => {\r\n  try {\r\n    await connectToDatabase();\r\n\r\n    const { postId } = req.query;\r\n\r\n    // Validate postId\r\n    if (!postId || typeof postId !== 'string') {\r\n      res.status(400).json({ error: 'Post ID is required' });\r\n      return;\r\n    }\r\n\r\n    if (!Types.ObjectId.isValid(postId)) {\r\n      res.status(400).json({ error: 'Invalid post ID' });\r\n      return;\r\n    }\r\n\r\n    // Get comments sorted by createdAt ascending\r\n    const comments = await Comment.find({ postId: new Types.ObjectId(postId) })\r\n      .sort({ createdAt: 1 })\r\n      .lean()\r\n      .exec();\r\n\r\n    res.json(comments);\r\n  } catch (error) {\r\n    console.error('Error fetching comments:', error);\r\n    res.status(500).json({ error: 'Failed to fetch comments' });\r\n  }\r\n};\r\n\r\n","import { RequestHandler } from 'express';\r\nimport { Types } from 'mongoose';\r\nimport { Post } from '../models';\r\nimport { connectToDatabase } from '../lib/mongodb';\r\n\r\n/**\r\n * POST /api/report\r\n * Report a post by incrementing its reportsCount\r\n */\r\nexport const reportPost: RequestHandler = async (req, res) => {\r\n  try {\r\n    await connectToDatabase();\r\n\r\n    const { postId } = req.body;\r\n\r\n    // Validate postId\r\n    if (!postId || typeof postId !== 'string') {\r\n      res.status(400).json({ error: 'Post ID is required' });\r\n      return;\r\n    }\r\n\r\n    if (!Types.ObjectId.isValid(postId)) {\r\n      res.status(400).json({ error: 'Invalid post ID' });\r\n      return;\r\n    }\r\n\r\n    // Check if post exists and increment reportsCount\r\n    const post = await Post.findByIdAndUpdate(\r\n      postId,\r\n      { $inc: { reportsCount: 1 } },\r\n      { new: true }\r\n    );\r\n\r\n    if (!post) {\r\n      res.status(404).json({ error: 'Post not found' });\r\n      return;\r\n    }\r\n\r\n    res.json({ success: true, reportsCount: post.reportsCount });\r\n  } catch (error) {\r\n    console.error('Error reporting post:', error);\r\n    res.status(500).json({ error: 'Failed to report post' });\r\n  }\r\n};\r\n\r\n","import { RequestHandler } from 'express';\r\nimport { Types } from 'mongoose';\r\nimport { Post, Comment } from '../models';\r\nimport { connectToDatabase } from '../lib/mongodb';\r\n\r\n/**\r\n * DELETE /api/post/:postId\r\n * Delete a post and all its comments\r\n */\r\nexport const deletePost: RequestHandler = async (req, res) => {\r\n  try {\r\n    await connectToDatabase();\r\n\r\n    const { postId } = req.params;\r\n\r\n    // Validate postId\r\n    if (!postId || !Types.ObjectId.isValid(postId)) {\r\n      res.status(400).json({ error: 'Invalid post ID' });\r\n      return;\r\n    }\r\n\r\n    // Check if post exists\r\n    const post = await Post.findById(postId);\r\n    if (!post) {\r\n      res.status(404).json({ error: 'Post not found' });\r\n      return;\r\n    }\r\n\r\n    // Delete all comments associated with this post\r\n    await Comment.deleteMany({ postId: new Types.ObjectId(postId) });\r\n\r\n    // Delete the post\r\n    await Post.findByIdAndDelete(postId);\r\n\r\n    res.json({ \r\n      success: true, \r\n      message: 'Post and associated comments deleted successfully' \r\n    });\r\n  } catch (error) {\r\n    console.error('Error deleting post:', error);\r\n    res.status(500).json({ error: 'Failed to delete post' });\r\n  }\r\n};\r\n\r\n","import \"dotenv/config\";\nimport express from \"express\";\nimport cors from \"cors\";\nimport { handleDemo } from \"./routes/demo\";\nimport { createPost } from \"./routes/post\";\nimport { getFeed } from \"./routes/feed\";\nimport { createComment, getComments } from \"./routes/comment\";\nimport { reportPost } from \"./routes/report\";\nimport { deletePost } from \"./routes/delete\";\n\nexport function createServer() {\n  const app = express();\n\n  // Middleware\n  app.use(cors());\n  app.use(express.json());\n  app.use(express.urlencoded({ extended: true }));\n\n  // Example API routes\n  app.get(\"/api/health\", (_req, res) => {\n    res.json({ ok: true });\n  });\n\n  app.get(\"/api/ping\", (_req, res) => {\n    const ping = process.env.PING_MESSAGE ?? \"ping\";\n    res.json({ message: ping });\n  });\n\n  app.get(\"/api/demo\", handleDemo);\n\n  // Community API routes\n  app.post(\"/api/post\", createPost);\n  app.get(\"/api/feed\", getFeed);\n  app.post(\"/api/comment\", createComment);\n  app.get(\"/api/comments\", getComments);\n  app.post(\"/api/report\", reportPost);\n  app.delete(\"/api/post/:postId\", deletePost);\n\n  return app;\n}\n","import path from \"path\";\nimport { createServer } from \"./index\";\nimport * as express from \"express\";\n\nconst app = createServer();\nconst port = process.env.PORT || 3000;\n\n// In production, serve the built SPA files\nconst __dirname = import.meta.dirname;\nconst distPath = path.join(__dirname, \"../spa\");\n\n// Serve static files\napp.use(express.static(distPath));\n\n// Handle React Router - serve index.html for all non-API routes\napp.get(\"*\", (req, res) => {\n  // Don't serve index.html for API routes\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\n    return res.status(404).json({ error: \"API endpoint not found\" });\n  }\n\n  res.sendFile(path.join(distPath, \"index.html\"));\n});\n\napp.listen(port, () => {\n  console.log(`ðŸš€ Fusion Starter server running on port ${port}`);\n  console.log(`ðŸ“± Frontend: http://localhost:${port}`);\n  console.log(`ðŸ”§ API: http://localhost:${port}/api`);\n});\n\n// Graceful shutdown\nprocess.on(\"SIGTERM\", () => {\n  console.log(\"ðŸ›‘ Received SIGTERM, shutting down gracefully\");\n  process.exit(0);\n});\n\nprocess.on(\"SIGINT\", () => {\n  console.log(\"ðŸ›‘ Received SIGINT, shutting down gracefully\");\n  process.exit(0);\n});\n"],"names":["app","express"],"mappings":"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"}